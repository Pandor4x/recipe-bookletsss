<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login / Sign Up</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: #ff99009d;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
          .auth-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
          }
          .auth-form-box {
               background: url("../img/banners.jpg");
               background-size: cover;        /* Makes the image fill the whole box */
               background-position: center;   /* Centers the image */
               background-repeat: no-repeat;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            padding: 32px 28px;
            margin-bottom: 32px;
            width: 1500px;
            max-width: 95vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            height: 800px;
            
          }
          .auth-form-box h2 {
            margin-bottom: 18px;
            color: #333;
            font-size: 1.5rem;
            margin-left: 500px;
            margin-top: 150px;
          }
          .auth-form-box label {
            width: 100%;
            text-align: left;
            font-size: 15px;
            margin-bottom: 4px;
            color: #333;
            
          }
          .auth-form-box input {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 14px;
            border-radius: 6px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
          }
          .auth-form-box .password-row {
            position: relative;
            width: 100%;
            display: flex;
            align-items: center;
          }
          .auth-form-box .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #888;
            font-size: 18px;
            cursor: pointer;
            padding: 0;
          }
          .auth-form-box button[type="submit"] {
            width: 100%;
            padding: 10px 0;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 8px;
            transition: background 0.2s;
          }
          .auth-form-box button[type="submit"]:hover {
            background: #333;
          }
          .auth-form-box .switch-link {
            color: #333;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 15px;
            margin-top: 8px;
            text-decoration: underline;
            padding: 0;
          }
          #authMessage {
            color: #d32f2f;
            margin-bottom: 18px;
            text-align: center;
            min-height: 24px;
            font-size: 15px;
          }
          .auth-success {
            color: #388e3c !important;
          }
          .auth-spinner {
            display: none;
            position: absolute;
            top: 10px;
            right: 10px;
            width: 24px;
            height: 24px;
            border: 3px solid #ff9800;
            border-top: 3px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            z-index: 2;
          }
          @keyframes spin {
            to { transform: rotate(360deg); }
          }
          @media (max-width: 400px) {
            .auth-form-box {
              padding: 18px 8px;
            }
          }
        </style>
      </head>
      <body>
        <header>
          <div class="header-center" style="width:100%;display:flex;flex-direction:column;align-items:center;">
            <h1>Pandora's Recipes</h1>
          </div>
        </header>
        <main class="auth-main">
          <div class="auth-form-box" id="loginBox">
            <span class="auth-spinner" id="loginSpinner"></span>
            <h2>Login</h2>
            <form id="loginForm" autocomplete="on" style="margin-left: 500px; ">
              <label for="loginEmail">Email</label>
              <input type="email" id="loginEmail" placeholder="Email" required autocomplete="email" value="">
              <label for="loginPassword">Password</label>
              <div class="password-row">
                <input type="password" id="loginPassword" placeholder="Password" required autocomplete="current-password" value="">
                <button type="button" class="toggle-password" tabindex="-1" aria-label="Show password" onclick="togglePassword('loginPassword', this)">üëÅÔ∏è</button>
              </div>
              <button type="submit">Log In</button>
              
            </form>   
            
            <button class="switch-link" onclick="showSignup()" style="margin-left: 500px; margin-top: 0px;">Don't have an account? Sign Up</button>
            <div id="authMessage"style="margin-left: 500px; margin-top: 10px;"></div>
          </div>
          <div class="auth-form-box" id="signupBox" style="display:none;">
            <span class="auth-spinner" id="signupSpinner"></span>
            <h2>Sign Up</h2>
            <form id="signupForm" autocomplete="on" style="margin-left: 500px;">
              <label for="signupEmail">Email</label>
              <input type="email" id="signupEmail" placeholder="Email" required autocomplete="email">
              <label for="signupPassword">Password</label>
              <div class="password-row">
                <input type="password" id="signupPassword" placeholder="Password" required autocomplete="new-password">
                <button type="button" class="toggle-password" tabindex="-1" aria-label="Show password" onclick="togglePassword('signupPassword', this)">üëÅÔ∏è</button>
              </div>
              <button type="submit">Sign Up</button>
            </form>
            <button class="switch-link" onclick="showLogin()" style="margin-left: 500px; margin-top: 0px;">Already have an account? Log In</button>
          </div>
          
        </main>
        <footer>
          <div class="footer-links">
            <a href="about.html">About Us</a>
            <span>|</span>
            <a href="terms.html">Terms of Service</a>
            <span>|</span>
            <a href="contact.html">Contact Us</a>
            <span>|</span>
            <a href="privacy.html">Privacy Policy</a>
          </div>
        </footer>
        <script>
          // Local search box: Enter -> go to index with query
          (function(){
            const input = document.getElementById('headerSearchInput');
            if (!input) return;
            input.addEventListener('keydown', function(e){
              if (e.key === 'Enter') {
                e.preventDefault();
                const q = (input.value || '').toString().trim();
                window.location.href = q ? `index.html?q=${encodeURIComponent(q)}` : 'index.html';
              }
            });
          })();
          const API_URL = 'https://pandor4x-pandorax-backend.onrender.com';

          // Password visibility toggle
          function togglePassword(inputId, btn) {
            const input = document.getElementById(inputId);
            if (input.type === "password") {
              input.type = "text";
              btn.textContent = "üôà";
            } else {
              input.type = "password";
              btn.textContent = "üëÅÔ∏è";
            }
          }

          function showSignup() {
            document.getElementById("loginBox").style.display = "none";
            document.getElementById("signupBox").style.display = "flex";
            document.getElementById("authMessage").textContent = "";
          }
          function showLogin() {
            document.getElementById("signupBox").style.display = "none";
            document.getElementById("loginBox").style.display = "flex";
            document.getElementById("authMessage").textContent = "";
          }

          const loginForm = document.getElementById("loginForm");
          const signupForm = document.getElementById("signupForm");
          const authMessage = document.getElementById("authMessage");
          const loginSpinner = document.getElementById("loginSpinner");
          const signupSpinner = document.getElementById("signupSpinner");

          loginForm.addEventListener("submit", async function(e) {
            e.preventDefault();
            loginSpinner.style.display = "inline-block";
            authMessage.textContent = "";
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;
            try {
              const res = await fetch(`${API_URL}/api/auth/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
              });
              const data = await res.json();
              loginSpinner.style.display = "none";
              if (!res.ok) {
                authMessage.textContent = data.error || JSON.stringify(data);
                authMessage.className = "";
                return;
              }
              // Store token and user info in the keys the app expects
              localStorage.setItem('token', data.token);
              if (data.user) localStorage.setItem('user', JSON.stringify(data.user));
              authMessage.textContent = "Logged in successfully!";
              authMessage.className = "auth-success";
              setTimeout(() => { window.location.href = 'index.html'; }, 900);
            } catch (err) {
              loginSpinner.style.display = "none";
              authMessage.textContent = 'Network error: ' + err.message;
              authMessage.className = "";
            }
          });

          signupForm.addEventListener("submit", async function(e) {
            e.preventDefault();
            signupSpinner.style.display = "inline-block";
            authMessage.textContent = "";
            const email = document.getElementById("signupEmail").value;
            const password = document.getElementById("signupPassword").value;
            if (password.length < 6) {
              signupSpinner.style.display = "none";
              authMessage.textContent = "Password must be at least 6 characters.";
              authMessage.className = "";
              return;
            }
            try {
              const res = await fetch(`${API_URL}/api/auth/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
              });
              const data = await res.json();
              signupSpinner.style.display = "none";
              if (!res.ok) {
                authMessage.textContent = data.error || JSON.stringify(data);
                authMessage.className = "";
                return;
              }
              authMessage.textContent = "Account created! You can now log in.";
              authMessage.className = "auth-success";
              setTimeout(() => { showLogin(); }, 900);
            } catch (err) {
              signupSpinner.style.display = "none";
              authMessage.textContent = 'Network error: ' + err.message;
              authMessage.className = "";
            }
          });
        </script>
      </body>
      </html>